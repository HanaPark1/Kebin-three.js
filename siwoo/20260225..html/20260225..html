<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>12차시 - Camera + Light + Shadow + Texture</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>

<body>

    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

    <script>
        // ==============================
        // 1️⃣ 기본 장면 설정
        // ==============================

        const scene = new THREE.Scene();

        scene.background = new THREE.Color(0x87CEEB); // 하늘색

        const camera = new THREE.PerspectiveCamera(
            75,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
        );

        camera.position.set(0, 5, 10);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true; // ⭐ 그림자 활성화
        document.body.appendChild(renderer.domElement);


        // ==============================
        // 2️⃣ 텍스처 로드
        // ==============================

        const textureLoader = new THREE.TextureLoader();

        const floorTexture = textureLoader.load(
            "나무 목재.png"
        );

        // 텍스처 반복 설정
        floorTexture.wrapS = THREE.RepeatWrapping;
        floorTexture.wrapT = THREE.RepeatWrapping;
        floorTexture.repeat.set(10, 10);

        // ==============================
        // 3️⃣ 바닥 생성
        // ==============================

        const floorMaterial = new THREE.MeshStandardMaterial({
            map: floorTexture
        });

        const floorGeometry = new THREE.PlaneGeometry(20, 20);
        const floor = new THREE.Mesh(floorGeometry, floorMaterial);
        

        floor.rotation.x = -Math.PI / 2;
        floor.receiveShadow = true; // ⭐ 그림자 받기
        scene.add(floor);

        const floor2=new THREE.Mesh(floorGeometry, floorMaterial);
        floor2.position.z=-10;
        scene.add(floor2);

        // ==============================
        // 4️⃣ 큐브 생성
        // ==============================

        const loader = new THREE.TextureLoader(); // 텍스처 로더

        const materials = [
            new THREE.MeshStandardMaterial({ map: loader.load("침대.png") }), // +X
            new THREE.MeshStandardMaterial({ map: loader.load("침대..png") }), // -X
            new THREE.MeshStandardMaterial({ map: loader.load("침대 위.png") }), // +Y
            new THREE.MeshStandardMaterial({ map: loader.load(".png") }), // -Y
            new THREE.MeshStandardMaterial({ map: loader.load("침대 오른쪽.png") }), // +Z
            new THREE.MeshStandardMaterial({ map: loader.load("침대 왼쪽.png") })  // -Z
        ]; // 배열에 텍스처 6면 담기

        const geometry = new THREE.BoxGeometry(2, 1, 1); // 지오메트리 형태 지정
        const cube2 = new THREE.Mesh(geometry, materials); // 메쉬 생성

    
        cube2.position.set(5,0.5,5);
        cube2.castShadow = true;

        scene.add(cube2);

        const testGeometry = new THREE.BoxGeometry(1, 1, 1); // 지오메트리 형태 지정
        const testMaterials = [
            new THREE.MeshStandardMaterial({ map: loader.load("상자 옆.png") }), // +X
            new THREE.MeshStandardMaterial({ map: loader.load("상자 앞.png") }), // -X
            new THREE.MeshStandardMaterial({ map: loader.load("상자 위.png") }), // +Y
            new THREE.MeshStandardMaterial({ map: loader.load("상자 아래.png") }), // -Y
            new THREE.MeshStandardMaterial({ map: loader.load("상자 옆.png") }), // +Z
            new THREE.MeshStandardMaterial({ map: loader.load("상자 옆.png") })  // -Z
        ];

        const testCube = new THREE.Mesh(testGeometry, testMaterials);
        testCube.position.y=0.5;
        scene.add(testCube);

    



        //const cubeMaterial = new THREE.MeshStandardMaterial({
        //    map: mat
        //});

        // ==============================
        // 5️⃣ 조명 추가
        // ==============================

        // 전체 밝기
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
        scene.add(ambientLight);

        // 태양 역할
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(5, 5, 5);
        directionalLight.castShadow = true;
        scene.add(directionalLight);

        // 그림자 품질 향상
        directionalLight.shadow.mapSize.width = 1024;
        directionalLight.shadow.mapSize.height = 1024;


        // ==============================
        // 6️⃣ 키 입력 처리
        // ==============================

        const keys = {};

        document.addEventListener("keydown", (event) => {
            keys[event.key] = true;
        });

        document.addEventListener("keyup", (event) => {
            keys[event.key] = false;
        });


        // ==============================
        // 7️⃣ 애니메이션 루프
        // ==============================

        const speed = 0.15;

        function animate() {
            requestAnimationFrame(animate);
            testCube.rotation.y += speed;

            // 카메라 이동
            if (keys["ArrowUp"]) camera.position.z -= speed;
            if (keys["ArrowDown"]) camera.position.z += speed;
            if (keys["ArrowLeft"]) camera.position.x -= speed;
            if (keys["ArrowRight"]) camera.position.x += speed;

            // 이동 범위 제한
            camera.position.x = Math.max(-15, Math.min(15, camera.position.x));
            camera.position.z = Math.max(-15, Math.min(15, camera.position.z));

            // 항상 원점 바라보기
            camera.lookAt(0, 0, 0);

            renderer.render(scene, camera);
        }

        animate();

    </script>

</body>

</html>