<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>12차시 - Camera + Light + Shadow + Texture</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>

<body>

    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

    <script>
        // ==============================
        // 1️⃣ 기본 장면 설정
        // ==============================

        const scene = new THREE.Scene();

        scene.background = new THREE.Color(0x87CEEB); // 하늘색

        const camera = new THREE.PerspectiveCamera(
            75,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
        );

        camera.position.set(0, 5, 10);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true; // ⭐ 그림자 활성화
        document.body.appendChild(renderer.domElement);


        // ==============================
        // 2️⃣ 텍스처 로드
        // ==============================

        const textureLoader = new THREE.TextureLoader();

        const floorTexture = textureLoader.load(
            "image copy.png"
        );

        // 텍스처 반복 설정
        floorTexture.wrapS = THREE.RepeatWrapping;
        floorTexture.wrapT = THREE.RepeatWrapping;
        floorTexture.repeat.set(10, 10);

        // ==============================
        // 3️⃣ 바닥 생성
        // ==============================

        const floorMaterial = new THREE.MeshStandardMaterial({
            map: floorTexture
        });

        const floorGeometry = new THREE.PlaneGeometry(20, 20);
        const floor = new THREE.Mesh(floorGeometry, floorMaterial);

        floor.rotation.x = -Math.PI / 2;
        floor.receiveShadow = true; // ⭐ 그림자 받기
        scene.add(floor);


        // ==============================
        // 4️⃣ 큐브 생성
        // ==============================

        const cubeTexture = textureLoader.load(
            "image copy 4.png"
        );

        const cubeMaterial = new THREE.MeshStandardMaterial({
            map: cubeTexture
        });

        const cubeGeometry = new THREE.BoxGeometry(1, 1, 1);
        const cube = new THREE.Mesh(cubeGeometry, cubeMaterial);

        cube.position.y = 0.5;
        cube.castShadow = true; // ⭐ 그림자 생성
        scene.add(cube);
        

        // ==============================
        // 5️⃣ 조명 추가
        // ==============================

        // 전체 밝기
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
        scene.add(ambientLight);

        // 태양 역할
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(5, 10, 5);
        directionalLight.castShadow = true;
        scene.add(directionalLight);

        // 그림자 품질 향상
        directionalLight.shadow.mapSize.width = 1024;
        directionalLight.shadow.mapSize.height = 1024;


        // ==============================
        // 6️⃣ 키 입력 처리
        // ==============================

        const keys = {};

        document.addEventListener("keydown", (event) => {
            keys[event.key] = true;
        });

        document.addEventListener("keyup", (event) => {
            keys[event.key] = false;
        });


        // ==============================
        // 7️⃣ 애니메이션 루프
        // ==============================

        const speed = 0.15;

        function animate() {
            requestAnimationFrame(animate);

            // 큐브 회전
            cube.rotation.x += 0.01;
            cube.rotation.y += 0.01;

            // 카메라 이동
            if (keys["ArrowUp"]) camera.position.z -= speed;
            if (keys["ArrowDown"]) camera.position.z += speed;
            if (keys["ArrowLeft"]) camera.position.x -= speed;
            if (keys["ArrowRight"]) camera.position.x += speed;

            // 이동 범위 제한
            camera.position.x = Math.max(-15, Math.min(15, camera.position.x));
            camera.position.z = Math.max(-15, Math.min(15, camera.position.z));

            // 항상 원점 바라보기
            camera.lookAt(0, 0, 0);

            renderer.render(scene, camera);
        }

        animate();

    </script>

</body>

</html>